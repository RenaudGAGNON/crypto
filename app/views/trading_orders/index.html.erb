<div class="container mx-auto px-4 py-8">
  <!-- Mode DRY -->
  <div class="mb-6 flex justify-between items-center">
    <div class="flex items-center space-x-4">
      <h1 class="text-2xl font-bold">Ordres de Trading</h1>
      <span class="px-3 py-1 rounded-full text-sm font-semibold <%= @dry_run ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800' %>">
        <%= @dry_run ? 'Mode Simulation' : 'Mode Réel' %>
      </span>
    </div>
    <div class="flex space-x-4">
      <%= link_to "Mode #{@dry_run ? 'Réel' : 'Simulation'}", trading_orders_path(dry_run: !@dry_run), class: "px-4 py-2 rounded-md #{@dry_run ? 'bg-green-600 hover:bg-green-700' : 'bg-yellow-600 hover:bg-yellow-700'} text-white" %>
      <%= link_to "Rafraîchir", refresh_trading_orders_path(dry_run: @dry_run), class: "px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md" %>
    </div>
  </div>

  <!-- Statistiques -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-gray-500 text-sm">Total Positions</h3>
      <p class="text-2xl font-bold"><%= @stats[:total_positions] %></p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-gray-500 text-sm">Positions Ouvertes</h3>
      <p class="text-2xl font-bold"><%= @stats[:open_positions] %></p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-gray-500 text-sm">Profit Total</h3>
      <p class="text-2xl font-bold <%= @stats[:total_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
        <%= @stats[:total_profit] %>%
      </p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-gray-500 text-sm">Win Rate</h3>
      <p class="text-2xl font-bold"><%= @stats[:win_rate] %>%</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-gray-500 text-sm">Profit Moyen</h3>
      <p class="text-2xl font-bold <%= @stats[:average_profit] >= 0 ? 'text-green-600' : 'text-red-600' %>">
        <%= @stats[:average_profit] %>%
      </p>
    </div>
  </div>

  <!-- Positions en Base de Données -->
  <div class="bg-white rounded-lg shadow mb-8">
    <div class="px-6 py-4 border-b">
      <h2 class="text-xl font-semibold">Positions en Base de Données</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symbole</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix d'Entrée</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantité</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Profit</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @positions.each do |position| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900"><%= position.symbol %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= position.entry_price %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= position.quantity %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= position.status == 'open' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800' %>">
                  <%= position.status %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm <%= position.total_profit_percentage >= 0 ? 'text-green-600' : 'text-red-600' %>">
                  <%= position.total_profit_percentage %>%
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= position.entry_time.strftime("%d/%m/%Y %H:%M") %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <%= link_to "Détails", trading_order_path(position), class: "text-indigo-600 hover:text-indigo-900" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="px-6 py-4 border-t">
      <%= paginate @positions %>
    </div>
  </div>

  <!-- Ordres Binance -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b">
      <h2 class="text-xl font-semibold">Derniers Ordres Binance</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symbole</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantité</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @binance_orders.each do |order| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900"><%= order['symbol'] %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= order['side'] == 'BUY' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                  <%= order['side'] %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= order['price'] %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= order['executedQty'] %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= order['status'] == 'FILLED' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800' %>">
                  <%= order['status'] %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900"><%= Time.at(order['time'] / 1000).strftime("%d/%m/%Y %H:%M") %></div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div> 